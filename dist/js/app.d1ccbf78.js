(function(){"use strict";var e={2420:function(e,t,n){var s=n(9242),r=n(3396),a=n(7718),i=n(9271);function o(e,t,n,s,o,l){const u=(0,r.up)("the-header"),c=(0,r.up)("router-view");return(0,r.wg)(),(0,r.j4)(a.q,null,{default:(0,r.w5)((()=>[(0,r.Wm)(u),(0,r.Wm)(i.O,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c)])),_:1})])),_:1})}var l=n(65),u=n(4870),c=n(7139),d=n(6357),f=n(9234),m=n(3289),g=n(7471),v=n(5030);const p=(0,r.Uk)("VK Friends"),h=(0,r.Uk)("mdi-export"),w=(0,r.Uk)("mdi-import");var _={setup(e){const t=(0,l.oR)(),n=(0,r.Fl)((()=>t.getters["auth/isLoggedIn"])),s=(0,r.Fl)((()=>`${t.state.auth.user.first_name} ${t.state.auth.user.last_name}`)),a=()=>t.dispatch("auth/logoutVK"),i=()=>t.dispatch("auth/loginVK");return(e,t)=>((0,r.wg)(),(0,r.j4)(g.iv,{dark:"",prominent:""},{default:(0,r.w5)((()=>[(0,r.Wm)(v.q,null,{default:(0,r.w5)((()=>[p])),_:1}),(0,r.Wm)(f.C),(0,u.SU)(n)?((0,r.wg)(),(0,r.j4)(d.T,{key:0,onClick:t[0]||(t[0]=e=>a())},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)((0,u.SU)(s))+" ",1),(0,r.Wm)(m.t,null,{default:(0,r.w5)((()=>[h])),_:1})])),_:1})):((0,r.wg)(),(0,r.j4)(d.T,{key:1,icon:"",onClick:t[1]||(t[1]=e=>i())},{default:(0,r.w5)((()=>[(0,r.Wm)(m.t,null,{default:(0,r.w5)((()=>[w])),_:1})])),_:1}))])),_:1}))}};const b=_;var y=b,S=(0,r.aZ)({name:"App",components:{TheHeader:y},data(){return{}},created(){this.login()},methods:{...(0,l.nv)({login:"auth/loginVK"})}}),k=n(89);const x=(0,k.Z)(S,[["render",o]]);var j=x,U=n(678),O=n(652),N=n(3701),V=n(6572),F=n(1888),I=n(8694);const W={class:"d-flex flex-no-wrap justify-space-between"};var C={props:{id:Number,color:String,title:String,sexName:String,age:String,friendsCount:Number,avatar:String},emits:["select-friend"],setup(e,{emit:t}){return(n,s)=>((0,r.wg)(),(0,r.j4)(N._,{width:"300",height:"175",color:e.color,theme:"light",class:"best-friend-card",onClick:s[0]||(s[0]=n=>t("select-friend",e.id))},{default:(0,r.w5)((()=>[(0,r._)("div",W,[(0,r._)("div",null,[(0,r.Wm)(V.E,{class:"text-h5"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)(e.title),1)])),_:1}),(0,r.Wm)(F.Z,null,{default:(0,r.w5)((()=>[(0,r._)("div",null,"Пол: "+(0,c.zw)(e.sexName),1),(0,r._)("div",null,"Возраст: "+(0,c.zw)(e.age),1),(0,r._)("div",null,"Друзья: "+(0,c.zw)(e.friendsCount),1)])),_:1})]),(0,r.Wm)(O.V,{class:"ma-3",size:"50px",rounded:"0"},{default:(0,r.w5)((()=>[(0,r.Wm)(I.f,{src:e.avatar},null,8,["src"])])),_:1})])])),_:1},8,["color"]))}};const D=(0,k.Z)(C,[["__scopeId","data-v-097f8d84"]]);var K=D,P=n(5475),T=n(3173);const $={class:"d-flex flex-column justify-start align-center h-100 w-100"},E={class:"align-self-stretch"},z={style:{padding:"10px"}},A=(0,r.Uk)("Build"),M={key:1,class:"align-self-stretch d-flex flex-wrap justify-center align-center"};var Z={setup(e){const t=(0,l.oR)(),n=(0,U.tv)(),s=(0,r.Fl)((()=>t.getters["search/autocompleteItems"])),a=(0,u.iH)(""),i=(0,r.Fl)((()=>"loading"===t.state.search.status)),o=e=>{a.value=e.target.value};(0,r.YP)((()=>a.value),(()=>{a.value.length>2&&t.dispatch("search/searchUserVK",a.value)}));const c=(0,r.Fl)({get:()=>t.state.search.selected,set:e=>{t.commit("search/setSelected",e)}});(0,r.YP)((()=>c.value.join(",")),(e=>{t.dispatch("search/addUserToDict",[...c.value])}));const f=(0,u.iH)(!1),m=async()=>{f.value=!0,await Promise.all(t.state.search.selected.map((e=>{const n=t.state.search.itemsDict[e].id;return t.dispatch("friends/getFriendsVK",n)}))),f.value=!1},g=e=>{const t=10,n=Math.min((e.friendsCount-1)/t,1);return`rgba(255,0,0,${n})`},v=(0,r.Fl)((()=>Object.values(t.getters["friends/allFriends"]).map((e=>({id:e.id,color:g(e),title:`${e.first_name} ${e.last_name}`,sexName:e.sexName,age:e.age,friendsCount:e.friendsCount,avatar:e.photo_50}))).sort(((e,t)=>e.title>t.title?1:e.title<t.title?-1:0)))),p=e=>{n.push(`/friend/${e}`)};return(e,t)=>((0,r.wg)(),(0,r.iD)("div",$,[(0,r._)("div",E,[(0,r.Wm)(P.f,{modelValue:(0,u.SU)(c),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,u.dq)(c)?c.value=e:null),"search-input":a.value,"onUpdate:search-input":t[1]||(t[1]=e=>a.value=e),loading:(0,u.SU)(i),items:(0,u.SU)(s),"cache-items":"",flat:"",label:"Search user:",multiple:"",chips:"","closable-chips":"",onInput:o},null,8,["modelValue","search-input","loading","items"])]),(0,r._)("div",z,[(0,r.Wm)(d.T,{onClick:m,loading:f.value},{default:(0,r.w5)((()=>[A])),_:1},8,["loading"])]),f.value?((0,r.wg)(),(0,r.j4)(T.L,{key:0,indeterminate:""})):((0,r.wg)(),(0,r.iD)("div",M,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,u.SU)(v),(e=>((0,r.wg)(),(0,r.j4)((0,u.SU)(K),(0,r.dG)({key:e.id},e,{onSelectFriend:p}),null,16)))),128))]))]))}};const H=Z;var L=H;const Y={class:"d-flex flex-no-wrap justify-space-between"};var q={props:{id:Number,title:String,sexName:String,age:String,avatar:String},setup(e){return(t,n)=>((0,r.wg)(),(0,r.j4)(N._,{width:"300",height:"175",theme:"light",class:"base-user-card"},{default:(0,r.w5)((()=>[(0,r._)("div",Y,[(0,r._)("div",null,[(0,r.Wm)(V.E,{class:"text-h5","data-test":"title"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,c.zw)(e.title),1)])),_:1}),(0,r.Wm)(F.Z,null,{default:(0,r.w5)((()=>[(0,r._)("div",null,"Пол: "+(0,c.zw)(e.sexName),1),(0,r._)("div",null,"Возраст: "+(0,c.zw)(e.age),1)])),_:1})]),(0,r.Wm)(O.V,{class:"ma-3",size:"50px",rounded:"0"},{default:(0,r.w5)((()=>[(0,r.Wm)(I.f,{src:e.avatar},null,8,["src"])])),_:1})])])),_:1}))}};const R=(0,k.Z)(q,[["__scopeId","data-v-1ffa8e7a"]]);var B=R;const G=e=>1===e?"Ж":2===e?"М":"Неизв.",J=e=>{if(!e)return"Не указан";const t=e.split(".");if(t.length<3)return"Неизв.";const n=new Date;let s=n.getFullYear()-Number(t[2]);(n.getMonth()<Number(t[1])-1||n.getMonth()===Number(t[1])-1&&n.getDate()<Number(t[0]))&&s--;let r="лет";return s%10===1?r="год":s%10&&s%10<=4&&(r="года"),`${s} ${r}`};const Q={class:"d-flex flex-column justify-start align-center h-100 w-100 friend-view"},X={style:{padding:"10px"}},ee=(0,r.Uk)("Back"),te={class:"d-flex flex-wrap justify-center align-center"},ne={key:1,class:"align-self-stretch d-flex flex-nowrap justify-center align-center flex-column"};var se={setup(e){const t=(0,l.oR)(),n=(0,U.tv)(),s=(0,U.yj)(),a=(0,r.Fl)((()=>t.getters["friends/allFriends"][s.params.id])),i=(0,r.Fl)((()=>{const e=t.state.search.items.reduce(((e,t)=>({...e,[t.id]:t})),{});return a.value.friendIds.map((t=>({id:t,title:`${e[t].first_name} ${e[t].last_name}`,sexName:G(e[t].sex),age:J(e[t].bdate),avatar:e[t].photo_50})))})),o=(0,r.Fl)((()=>`${a.value.first_name} ${a.value.last_name}`)),f=(0,u.iH)(!0),m=async()=>{f.value=!0,await t.dispatch("wall/getWallVK",s.params.id),f.value=!1},g=()=>n.back(),v=(0,r.Fl)((()=>t.state.wall.items));return m(),(e,t)=>((0,r.wg)(),(0,r.iD)("div",Q,[(0,r._)("h1",null,(0,c.zw)((0,u.SU)(o)),1),(0,r._)("div",X,[(0,r.Wm)(d.T,{onClick:g},{default:(0,r.w5)((()=>[ee])),_:1})]),(0,r._)("div",te,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,u.SU)(i),(e=>((0,r.wg)(),(0,r.j4)((0,u.SU)(B),(0,r.dG)({key:e.id},e),null,16)))),128))]),f.value?((0,r.wg)(),(0,r.j4)(T.L,{key:0,indeterminate:""})):((0,r.wg)(),(0,r.iD)("div",ne,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,u.SU)(v),(e=>((0,r.wg)(),(0,r.iD)("div",{key:e.id,class:"friend-view__wall-item"},(0,c.zw)(e.text),1)))),128))]))]))}};const re=(0,k.Z)(se,[["__scopeId","data-v-622e497a"]]);var ae=re;const ie=[{path:"/",name:"home",component:L},{path:"/friend/:id",name:"friend",component:ae}],oe=(0,U.p7)({history:(0,U.PO)("/vk-friends-vue/dist/"),routes:ie});var le=oe,ue=n(2482);class ce{constructor(){(0,ue.Z)(this,"api",VK)}login(e=0){return new Promise(((t,n)=>{VK.Auth.login((e=>{t(e)}),e)}))}logout(){return new Promise((e=>{VK.Auth.logout((()=>{e()}))}))}call(e,t){return new Promise((n=>{VK.Api.call(e,t,(e=>{n(e)}))}))}}var de=new ce;const fe=()=>({error:"",session:null,user:null,status:"initial"}),me={isLoggedIn:e=>e.user&&"connected"===e.status},ge={setStatus:(e,t)=>{e.status=t},setSession:(e,t)=>{e.session=t},setUser:(e,t)=>{e.user=t}},ve={loginVK({commit:e}){e("setStatus","loading"),de.login().then((t=>{const{session:{user:n,...s},status:r}=t;e("setSession",s),e("setUser",n),e("setStatus",r)}))},logoutVK({commit:e}){e("setStatus","loading"),de.logout().then((()=>{e("setSession",null),e("setUser",null),e("setStatus","unknown")}))}},pe={namespaced:!0,state:fe,getters:me,mutations:ge,actions:ve};var he=pe;n(6699);const we=()=>({error:"",items:[],selected:[],itemsDict:{},status:"initial"}),_e={autocompleteItems:e=>e.items.map((e=>({...e,title:`${e.first_name} ${e.last_name} (${e.screen_name})`,value:e.screen_name})))},be={setStatus:(e,t)=>{e.status=t},setItems:(e,t)=>{e.items=t},setSelected:(e,t)=>{e.selected=t},setItemsDict:(e,t)=>{e.itemsDict=t},setError:(e,t)=>{e.error=t}},ye={addUserToDict({commit:e,getters:t,state:n},s){const r=s.filter((e=>!n.itemsDict[e])),a=t.autocompleteItems.filter((e=>r.includes(e.screen_name))),i=a.reduce(((e,t)=>({...e,[t.screen_name]:t})),{...n.itemsDict});e("setItemsDict",i)},searchUserVK({commit:e},t){e("setStatus","loading"),de.call("users.search",{q:t,v:"5.131",fields:["sex","bdate","photo_50","screen_name"]}).then((t=>{const{response:{items:n}}=t;e("setItems",n),e("setStatus","done")}))}},Se={namespaced:!0,state:we,getters:_e,mutations:be,actions:ye};var ke=Se;const xe=()=>({error:"",items:{},status:"initial"}),je={allFriends(e){const t={};for(let n in e.items)for(let s=0;s<e.items[n].length;s++){const r=e.items[n][s];t[r.id]?(t[r.id].friendsCount++,t[r.id].friendIds.push(Number(n))):t[r.id]={...r,friendsCount:1,sexName:G(r.sex),age:J(r.bdate),friendIds:[Number(n)]}}return t}},Ue={setStatus:(e,t)=>{e.status=t},setItems:(e,t)=>{e.items=t},setError:(e,t)=>{e.error=t}},Oe={getFriendsVK({commit:e,state:t},n){return e("setStatus","loading"),de.call("friends.get",{user_id:n,v:"5.131",fields:["sex","bdate","photo_50","screen_name"]}).then((s=>{const{error:r}=s;if(r)return e("setStatus","done"),void e("setError",r.error_msg);const{response:{items:a}}=s,{items:i}=t;e("setItems",{...i,[n]:a}),e("setStatus","done")}))}},Ne={namespaced:!0,state:xe,getters:je,mutations:Ue,actions:Oe};var Ve=Ne;const Fe=()=>({error:"",items:[],status:"initial"}),Ie={},We={setStatus:(e,t)=>{e.status=t},setItems:(e,t)=>{e.items=t},setError:(e,t)=>{e.error=t}},Ce={getWallVK({commit:e,state:t},n){return e("setStatus","loading"),de.call("wall.get",{owner_id:n,v:"5.131"}).then((t=>{const{error:n}=t;if(n)return e("setStatus","done"),void e("setError",n.error_msg);const{response:{items:s}}=t;e("setItems",s),e("setStatus","done")}))}},De={namespaced:!0,state:Fe,getters:Ie,mutations:We,actions:Ce};var Ke=De,Pe=(0,l.MT)({state:{},getters:{},mutations:{},actions:{},modules:{auth:he,search:ke,friends:Ve,wall:Ke}}),Te=(n(9773),n(3398)),$e=(0,Te.Rd)();async function Ee(){const e=await n.e(461).then(n.t.bind(n,3657,23));e.load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}Ee(),(0,s.ri)(j).use(le).use(Pe).use($e).mount("#app")}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,s,r,a){if(!s){var i=1/0;for(c=0;c<e.length;c++){s=e[c][0],r=e[c][1],a=e[c][2];for(var o=!0,l=0;l<s.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(o=!1,a<i&&(i=a));if(o){e.splice(c--,1);var u=r();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[s,r,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(s,r){if(1&r&&(s=this(s)),8&r)return s;if("object"===typeof s&&s){if(4&r&&s.__esModule)return s;if(16&r&&"function"===typeof s.then)return s}var a=Object.create(null);n.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&s;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((function(e){i[e]=function(){return s[e]}}));return i["default"]=function(){return s},n.d(a,i),a}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,s){return n.f[s](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/webfontloader.f0170176.js"}}(),function(){n.miniCssF=function(e){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="vk-vue:";n.l=function(s,r,a,i){if(e[s])e[s].push(r);else{var o,l;if(void 0!==a)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==t+a){o=d;break}}o||(l=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+a),o.src=s),e[s]=[r];var f=function(t,n){o.onerror=o.onload=null,clearTimeout(m);var r=e[s];if(delete e[s],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((function(e){return e(n)})),t)return t(n)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=f.bind(null,o.onerror),o.onload=f.bind(null,o.onload),l&&document.head.appendChild(o)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/vk-friends-vue/dist/"}(),function(){var e={143:0};n.f.j=function(t,s){var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)s.push(r[2]);else{var a=new Promise((function(n,s){r=e[t]=[n,s]}));s.push(r[2]=a);var i=n.p+n.u(t),o=new Error,l=function(s){if(n.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var a=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",o.name="ChunkLoadError",o.type=a,o.request=i,r[1](o)}};n.l(i,l,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,a,i=s[0],o=s[1],l=s[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(r in o)n.o(o,r)&&(n.m[r]=o[r]);if(l)var c=l(n)}for(t&&t(s);u<i.length;u++)a=i[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},s=self["webpackChunkvk_vue"]=self["webpackChunkvk_vue"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(2420)}));s=n.O(s)})();
//# sourceMappingURL=app.d1ccbf78.js.map